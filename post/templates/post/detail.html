{% extends 'base.html' %} {% block content %}


    <div class="text-center">
        <a href="/">
            <button>뒤돌아가기</button>
        </a>
        <h1>제목: {{post.title}}</h1>
        <p>{{ post.user.image }}</p>
        <p>{{ post.user.username }}</p>
        <p>{{post.content}}</p>

        {% if post.post_image %}
        <div class="text-center">
            <img src="{{post.post_image.url}}" class="rounded" alt="">
        </div>
        {% endif %}

        <p>작성시간: {{post.created_at}}</p>
        <p>수정시간: {{post.updated_at}}</p>


        {% if request.user == post.user %}
        <div>
        <a href="/post/{{post.id}}/update/">
            {% csrf_token %}
            <button>수정하기</button>
        </a>
        <form action="/post/{{post.id}}/delete/" method="post">
            {% csrf_token %}
            <button>삭제하기</button>
        </form>        
        {% endif %}

        {% if request.user.is_authenticated %}
        <form action="/post/comment_create/" method="post">
            {% csrf_token %}
            <input type="text" name="comment_content" id="comment_content">
            <button type="submit" class="btn btn-sm btn-outline-secondary">댓글 작성</button>
        </form>
        {% else %}
        <button  onclick="return alert('로그인 후 댓글 작성 가능합니다.');" type="button" class="btn btn-sm btn-outline-secondary">댓글 작성</button>
        {% endif %}
        
        {% if post.id == request.post.id %} <!--현재 보고 있는 상세페이지의 post의 id와 comment의 post id가 같을 때-->
            {% for comment in comment_list %}
            <a href="/user/mypage/">
                {% if comment.user.image.url %}
                <img src="{{comment.user.image.url}}" alt="" srcset="">
                {% else %}
                <img src="/media/profile_pics/'default.jpg" alt="" srcset="">
                <p>{{comment.user.fullname}}</p>
                {% endif %}
            </a>
                {% if request.user == comment.user %}
                <form action="/post/{{ comment.id }}/comment_update/" method="post">
                    {% csrf_token %}  
                    <input type="text" name="content" id="content" value="{{ comment.content }}"
                    /> <br>     
                </form>
                <form action="/post/{{ comment.id }}/comment_delete/" method="post">
                    {% csrf_token %}
                    <button>삭제하기</button>
                </form> 
                {% else %}
                <p>{{comment.content}}</p>
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>
{% endblock %}